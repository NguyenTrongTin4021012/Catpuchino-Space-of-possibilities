<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Catpuchino: The Space of Posibilities</title>
  <!-- Document title corrected for spelling -->
  <link rel="stylesheet" href="style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://use.typekit.net/ygq6itx.css">
  <link rel="icon" href="data:,">
  <script src="https://cdn.jsdelivr.net/npm/p5@1.11.11/lib/p5.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/p5@1.11.11/lib/addons/p5.sound.min.js"></script>
</head>
<body>
  <header class="site-header">
    <div class="header-inner">
      <a class="brand" href="main.html"><h2>Space of Posibilities</h2></a>
      <button id="nav-toggle" aria-label="Toggle navigation">☰</button>
      <nav id="site-nav" class="site-nav">
        <a class="about" href="#" onclick="openInfoPopup(event)">About</a>
        <a class="guides" href="#" onclick="openGuidePopup(event)">Guides</a>
        <div class="nav-dropdown">
          <a class="works" href="#" class="dropdown-toggle">Works</a>
          <div class="dropdown-menu">
            <a href="trang.html">Planetary Soroban</a>
            <a href="bach.html">Disrupted Saturn</a>
            <a href="khoa.html">The Sun</a>
            <a href="tin.html">Turbulence</a>
          </div>
        </div>
      </nav>
    </div>
  </header>
  <main>
    <div id="p5-container"></div>
    <!-- Popup -->
    <!-- Information popup (hidden by default) -->
    <div id="info-popup" class="info-popup">
      <div class="popup-content">
        <button class="close-popup" onclick="closeInfoPopup()">×</button>
        <h1>SGD 4: Quality of Education</h1>
        <p>"Children must be taught how to think, not what to think."</p>
        <p>- Coming of Age in Samoa: A Psychological Study of Primitive Youth for Western Civilisation(1928), by Margaret Mead</p>
        <p>This is the quote which inspired our project.</p>
      </div>
    </div>

    <!-- Guide popup (same styling as info) -->
    <div id="guide-popup" class="info-popup">
      <div class="popup-content">
        <button class="close-popup" onclick="closeGuidePopup()">×</button>
        <h2>Guide</h2>
        <p>Click on the project to explore them</p>
      </div>
    </div>
    
    <!-- Overlay for popup -->
    <div id="popup-overlay" class="popup-overlay" onclick="closeAllPopups()"></div>
    
    <!-- Content that will display on top -->
    <section id="overlay-content" class="overlay-section">
      <div class="content-inner">
        <h1>Stop rote learning, let students explore their own universe</h1>
        <p>Like the universe, we are a star or even a planet.</p>
        <p>Each of us will have our own unique experiences and learning knowledge.</p>
      </div>
    </section>
  </main>
  <script>
    // Page navigation with fade transition
    (function() {
      const body = document.body;

      window.addEventListener('DOMContentLoaded', () => {
        requestAnimationFrame(() => body.classList.add('page-fade-in'));
      });

      function navigateWithFade(url) {
        // Remove the visible class to trigger CSS transition, then navigate
        body.classList.remove('page-fade-in');

        // Wait for the opacity transition to finish, then change location.
        const onEnd = () => { window.location.href = url; body.removeEventListener('transitionend', onEnd); };
        body.addEventListener('transitionend', onEnd);

        // Fallback in case transitionend doesn't fire — derive from CSS var
        try {
          const d = getComputedStyle(document.documentElement).getPropertyValue('--page-fade-duration').trim() || '420ms';
          const ms = d.endsWith('ms') ? parseFloat(d) : (d.endsWith('s') ? parseFloat(d) * 1000 : 420);
          setTimeout(onEnd, Math.ceil(ms * 1.25));
        } catch (e) {
          setTimeout(onEnd, 800);
        }
      }

      // Attach fade navigation to local HTML links
      const links = document.querySelectorAll('a[href$=".html"]');
      links.forEach(link => {
        link.addEventListener('click', (e) => {
          const href = link.getAttribute('href');
          if (!href || href.startsWith('#')) return;
          e.preventDefault();
          navigateWithFade(href);
        });
      });

      window.navigateWithFade = navigateWithFade;
    })();

    // Dropdown menu toggle with auto-close timer
    (function() {
      const dropdown = document.querySelector('.nav-dropdown');
      const toggle = dropdown?.querySelector('.dropdown-toggle');
      let closeTimer = null;

      if (toggle && dropdown) {
        toggle.addEventListener('click', (e) => {
          e.preventDefault();
          
          // Clear any existing timer
          if (closeTimer) {
            clearTimeout(closeTimer);
            closeTimer = null;
          }

          // Toggle active state
          if (dropdown.classList.contains('active')) {
            dropdown.classList.remove('active');
          } else {
            dropdown.classList.add('active');
            
            // Auto-close after 10 seconds
            closeTimer = setTimeout(() => {
              dropdown.classList.remove('active');
              closeTimer = null;
            }, 10000);
          }
        });

        // Clear timer and active state when clicking outside
        document.addEventListener('click', (e) => {
          if (!dropdown.contains(e.target)) {
            if (closeTimer) {
              clearTimeout(closeTimer);
              closeTimer = null;
            }
            dropdown.classList.remove('active');
          }
        });
      }
    })();

    // Popup controls
    function openInfoPopup(event) {
      if (event) event.preventDefault();
      const popup = document.getElementById('info-popup');
      const overlay = document.getElementById('popup-overlay');
      if (popup) popup.classList.add('visible');
      if (overlay) overlay.classList.add('visible');
    }

    function openGuidePopup(event) {
      if (event) event.preventDefault();
      const popup = document.getElementById('guide-popup');
      const overlay = document.getElementById('popup-overlay');
      if (popup) popup.classList.add('visible');
      if (overlay) overlay.classList.add('visible');
    }

    function closeInfoPopup() {
      const popup = document.getElementById('info-popup');
      if (popup) popup.classList.remove('visible');
      closeOverlayIfNoneOpen();
    }

    function closeGuidePopup() {
      const popup = document.getElementById('guide-popup');
      if (popup) popup.classList.remove('visible');
      closeOverlayIfNoneOpen();
    }

    function closeAllPopups() {
      const popups = document.querySelectorAll('.info-popup');
      popups.forEach(p => p.classList.remove('visible'));
      const overlay = document.getElementById('popup-overlay');
      if (overlay) overlay.classList.remove('visible');
    }

    function closeOverlayIfNoneOpen() {
      const overlay = document.getElementById('popup-overlay');
      const anyOpen = document.querySelector('.info-popup.visible');
      if (!anyOpen && overlay) overlay.classList.remove('visible');
    }

    // Show footer only when scrolled to bottom
    (function() {
      const footer = document.querySelector('footer');
      function checkFooterVisibility() {
        if (!footer) return;
        const scrollY = window.scrollY || window.pageYOffset;
        const viewport = window.innerHeight || document.documentElement.clientHeight;
        const fullHeight = document.documentElement.scrollHeight;
        if (scrollY + viewport >= fullHeight - 2) {
          footer.classList.add('footer-visible');
        } else {
          footer.classList.remove('footer-visible');
        }
      }
      window.addEventListener('scroll', checkFooterVisibility);
      window.addEventListener('resize', checkFooterVisibility);
      document.addEventListener('DOMContentLoaded', checkFooterVisibility);
    })();
  </script>
  <script src="script.js"></script>
  <footer>
      <div class="footer-inner">
        <div class="footer-content">
          <span>&copy; 2026 Catpuchino</span>
          <span class="footer-links">
            <a href="main.html">Home</a> |
            <a href="#" onclick="openInfoPopup(event)">About</a> |
            <a href="#" onclick="openGuidePopup(event)">Guides</a>
          </span>
          <span class="footer-credit">Design &amp; code by Nguyen Trong Tin, Nguyen Thai Xuan Bach, Pham Ha Hoang Trang, Bui Nguyen Khoa.</span>
        </div>
      </div>
  </footer>
</body>
</html>
